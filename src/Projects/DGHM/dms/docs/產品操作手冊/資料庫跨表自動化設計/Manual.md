# 手冊

本文件說明 Airtable 中「主表 × 子表」搭配自動化（Automation）之正確操作方式，  
目的在於避免資料錯誤連結、品項共用、重複計價與 Orphan Items 發生。

> 📌 文件定位說明  
> 本文件作為本專案自動化系統之「操作與使用依據」，  
> 不包含系統設定方式、Automation 編輯內容或程式邏輯細節，  
> 亦不作為系統調整或功能變更之教學文件。

---

## 0. 使用前請務必閱讀

本系統**不是 Excel**。

部分資料並非人工建立，而是由系統根據使用者操作即時產生、分群與清理。  
錯誤的操作方式（尤其是 Duplicate）將直接造成資料結構錯亂。

---

## 文件使用範圍說明

本文件目的為說明「既有自動化系統」之**正確操作方式與使用限制**，  
並非系統設定、邏輯修改或自動化設計之教學文件。

如需調整以下內容，請另行評估與委託：

- Automation 觸發條件或執行邏輯
- 欄位結構、資料表關聯方式
- 子表資料生成、分群或清理規則

---

## 1. 系統整體設計概念

### 1.1 主表與子表角色說明

- **主表（如 ✏️ Quotations / ✏️ AIRWAYBILL/POD / ✏️ Debit Notes）**
  - 屬業務層級資料
  - Job No.、Partner、Status...
  - 唯一入口

- **子表（如 🟨 Package Items / 🔴 Charge Items / 🔵 Non-Taxable Charges）**
  - 系統自動建立之明細資料
  - 不允許人工新增或修改(使用建議)

---

### 1.2 什麼是「暫存欄位（Temp）」？

暫存欄位僅用於「觸發自動化」：

- 使用者選取品項
- 系統展開子表資料(自動於子表依 Job No. 分群)
- 系統清空暫存欄位

暫存欄位(如欄位：🟨 選取箱型(暫)) **不保留最終資料**。

---

### 1.3 自動分類建立機制說明（對應報價項目）

當使用者於主表中，透過標示為「(暫)」的欄位選取項目時：

- 系統會自動於對應子表建立明細資料
- 每一筆子表資料僅對應一筆主表單號（Job No.）
- 不同單號之品項不會共用或混合
- 建立完成後，暫存欄位將自動清空

此機制適用於以下子表類型：

- 🟨 Package Items
- 🔴 Charge Items
- 🔵 Non-Taxable Charges

---

## 2. 正確操作流程（唯一允許方式）

### 2.1 建立新單（正確）

1. 新增一筆「空白」主表資料
2. 確認單號為全新、未使用過
3. 於 `(暫)` 欄位選取品項
4. 等待系統執行自動化以自動分群完成(約 2 秒內)
5. 確認：
   - (暫) 欄位已清空
   - 子表資料會自動建立

---

### 2.2 標準操作流程（SOP｜供實際填單人員參考）

以下流程僅供已理解本文件 **第 0～3 章系統規則** 之使用者參考。  
若未先閱讀上述章節，請勿僅依此 SOP 進行操作。

#### 建立一筆新單（ ✏️ Quotations / ✏️ AIRWAYBILL/POD / ✏️ Debit Notes）的標準流程

1. 於主表（如 ✏️ Quotations）中 **新增一筆空白資料**
2. 填寫 Job No.
   - 確認為「全新、未曾使用」之編號
   - 請勿透過 Duplicate 方式產生
3. 依實際業務情境填寫 Partner / Shipper / Consignee 等基本欄位
4. 於主表中標示為 `(暫)` 的欄位（如：🟨 選取箱型(暫)）選取所需品項
5. 等待系統自動化執行（約 1～2 秒）
6. 確認系統狀態：
   - `(暫)` 欄位已自動清空
   - 對應之子表資料（如 🟨 Package Items）已自動建立並依 Job No. 分群
7. 前往子表，僅填寫以下允許人工補充之欄位：
   - 數量（Quantity）
   - 重量（Weight）
   - 批號 / 序號 / 備註等明細資訊

⚠ 注意事項

- 若需 **新增、移除或調整品項**，請一律回到主表重新操作 `(暫)` 欄位
- 請勿直接修改子表中的「連結欄位」
- 若子表資料異常，請勿嘗試人工修正，請回報系統管理人員處理

---

## 3. ❌ 嚴格禁止事項

### 3.1 禁止使用 Duplicate

Duplicate 會複製：

- 舊單號
- 舊子表連結
- 舊品項關係

系統因認定品項共用單號，故無法判斷哪些資料屬於新單。

---

### 3.2 禁止直接操作子表

請勿：

- 手動新增子表資料
- 修改子表的連結欄位
- 嘗試「修正」Unnamed record

除外：

- 更改數量(Quantity)、各類重量(Weight)或手動輸入價格(Manual Price)
- 填寫該單品項之詳細資訊(如：OMS > 🟨 Package Items > Item Description, Batch/ Lot Number...等)

---

## 4. 常見錯誤說明

### 問題：子表出現 Unnamed record

**原因**

- 使用 Duplicate
- 人工修改連結欄位

**建議處理方式**

- 重新建立新單
- 刪除品項並重新於(暫)的欄位選取品項
- 套用 Record Template

---

### 常見誤用情境提醒

以下行為常見於 Excel 使用習慣，  
但在本系統中將導致資料結構錯亂或品項錯誤共用：

- 複製整列資料後再修改單號（Duplicate）
- 嘗試自行修正子表中的 Unnamed record
- 直接於子表新增、刪除或調整連結欄位

上述行為皆非本系統設計之使用方式，  
亦可能導致後續帳務、計價或分群錯誤。

## 5. 系統自動化行為摘要

系統會自動：

- 建立子表資料
- 維持一對一關係(一單(Quotation) vs 一清單表(Package Item Group))
- 清理 Orphan Items
- 當主表資料與子表之連結關係被系統判定為失效時
  （例如：主表單號變更、品項重新選取）
  系統將自動清理對應之子表無效資料（Orphan Items）

請勿嘗試人工介入。

---

## 6. 操作原則總結

- 不 Duplicate
- 只操作主表
- 只使用主表中有標記 (暫) 之欄位
- 子表完全交由系統處理

---

## 7. 問題回報與處理原則

當發生以下狀況時，請回報系統管理人員或專案窗口處理：

- 子表資料出現異常連結或 Unnamed record
- 自動化未依預期建立或清理資料
- 操作後資料未即時更新或顯示異常

請勿嘗試自行調整資料結構或修正連結關係，  
以避免造成更大範圍的資料錯誤。
